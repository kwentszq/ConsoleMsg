import java.io.*;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Scanner;

public class Chat {
    private String currentUser;
    private String chatFile = "chat.json";

    public Chat(String currentUser) {
        this.currentUser = currentUser;
    }

    public void start() {
        Scanner scan = new Scanner(System.in);

        System.out.println("\nğŸ’¬ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ñ‡Ğ°Ñ‚, " + currentUser + "!");

        while (true) {
            System.out.println("\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:");
            System.out.println("1 - ğŸ“¨ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ");
            System.out.println("2 - ğŸ“– ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ");
            System.out.println("3 - ğŸšª Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ñ‡Ğ°Ñ‚Ğ°");
            System.out.print("Ğ’Ğ°Ñˆ Ğ²Ñ‹Ğ±Ğ¾Ñ€: ");

            String choice = scan.nextLine();

            switch (choice) {
                case "1":
                    System.out.print("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ: ");
                    String message = scan.nextLine();
                    sendMessage(message);
                    break;

                case "2":
                    showMessages();
                    break;

                case "3":
                    System.out.println("ğŸ‘‹ Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ñ‡Ğ°Ñ‚Ğ°...");
                    return;

                default:
                    System.out.println("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€!");
            }
        }
    }

    private void sendMessage(String message) {
        try (FileWriter writer = new FileWriter(chatFile, true)) {
            writer.write(currentUser + ": " + message + "\n");
            System.out.println("âœ… Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!");
        } catch (IOException e) {
            System.out.println("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸: " + e.getMessage());
        }
    }

    private void showMessages() {
        System.out.println("\nğŸ“¨ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°:");
        System.out.println("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        if (!Files.exists(Paths.get(chatFile))) {
            System.out.println("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚");
        } else {
            try (BufferedReader reader = Files.newBufferedReader(Paths.get(chatFile))) {
                String line;
                while ((line = reader.readLine()) != null) {
                    System.out.println(line);
                }
            } catch (IOException e) {
                System.out.println("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ: " + e.getMessage());
            }
        }
        System.out.println("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    }
}